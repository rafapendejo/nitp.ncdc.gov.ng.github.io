(function($){Drupal.behaviors.nitp_charts={attach:function(context,settings){window.addEventListener('load',(event)=>{_get_all_states(link1);var sid=getUrlParameters();var link1=`https://lagosepid.com/server/api/NITP_report_combo_api.php?stateid=${sid[0]}`;if($("#ncm_d2_canvas").length){_generate_d2_d7_chart(link1,"ncm_d2_canvas","D2 Test Overview","ncm_d7_canvas","D7 Test Overview");}
if($("#ncm_d2_histogram").length){_generate_d2_d7_hist_chart(link1,"ncm_d2d7_ratio_histogram","ncm_d2_histogram","ncm_d7_histogram","D2 Testing Ratio","D7 Testing Ratio","D2 Test","D2 Positive","D7 Test","D7 Positive");}
if($("#ncm_paxtrend_histogram").length){_generate_paxtrend_chart(link1,"ncm_paxtrend_histogram");_generate_daily_tables(link1);}})
function getUrlParameters(){let urlString=window.location.href;let paramString=urlString.split('?')[1];let cleanurl=urlString.split('?')[0];let queryString=new URLSearchParams(paramString);for(let pair of queryString.entries()){var sid=pair[1];}
return[sid,cleanurl];}
function _get_all_states(url){var allstates=['All','Abia','Adamawa','Akwa ibom','Anambra','Bauchi','Bayelsa','Benue','Borno','Cross river','Delta','Ebonyi','Edo','Ekiti','Enugu','FCT','Gombe','Imo','Jigawa','Kaduna','Kano','Katsina','Kebbi','Kogi','Kwara','Lagos','Nassarawa','Niger','Ogun','Ondo','Osun','Oyo','Plateau','Rivers','Sokoto','Taraba','Yobe','Zamfara'];var stateids=['All','14038','14039','14040','14041','14042','14043','14044','14045','14046','14047','14048','14049','14051','14052','20627','14053','14054','14055','14056','14057','14058','14059','14060','14061','14062','14064','14065','14066','14067','14068','14069','14070','14071','14072','14073','14074','14075'];if($("#stateid_category").length)
$.ajax({success:function(result){var option='';var sid_state=getUrlParameters();$("#stateid_category").append(option);$.each(allstates,function(key,value){var states=allstates[key];var state_key=stateids[key];if(sid_state[0]==state_key){option=`<option value='${state_key}' selected="selected">${states}</option>`;}
else{option=`<option value='${state_key}'>${states}</option>`;}
$("#stateid_category").append(option);});},error:function(error){console.log('there is an error trying to locate all states')}});}
function _generate_daily_tables(url){if($("#ncm_daily_values_table").length){$.ajax({url:url,dataType:"json",success:function(result){var body="";$(".table_body").remove();$.each(result['table_result']['weektext'],function(key,value){var weektext=result['table_result']['weektext'][key];var paxcount=result['table_result']['paxcount'][key];var d2test=result['table_result']['d2test'][key];var d2positive=result['table_result']['d2positive'][key];var d7test=result['table_result']['d7test'][key];var d7positive=result['table_result']['d7positive'][key];var fullyvax=result['table_result']['fullyvax'][key];var diplomats=result['table_result']['diplomats'][key];body=`<tr class="table_body"><td>${weektext}</td><td>${paxcount}</td><td>${d2test}</td>
                               <td>${d2positive}</td><td>${d7test}</td><td>${d7positive}</td>
                               <td>${fullyvax}</td><td>${diplomats}</td></tr>`;$("#ncm_daily_values_table").append(body);});var total_val=result['table_result']['Total'];body=`<tr class="table_leg"><td>Total</td><td>${total_val[0]}</td><td>${total_val[1]}</td>
                                    <td>${total_val[2]}</td><td>${total_val[3]}</td><td>${total_val[4]}</td>
                                    <td>${total_val[5]}</td><td>${total_val[6]}</td>
                                </tr>`
$(".table_leg").remove();$("#ncm_daily_values_table").append(body);},error:function(error){console.log('there is an error trying to generate table report')}});}}
function _generate_d2_d7_chart(url,canvas_id,chart_text,canvas_id2,chart_text2){$.ajax({url:url,dataType:"json",success:function(result){nitpchart_Pie(canvas_id,result['D2_pie']["label"],result['D2_pie']["values"],chart_text);nitpchart_Pie(canvas_id2,result['D7_pie']["label"],result['D7_pie']["values"],chart_text2);Swal.close();},error:function(error){console.log('this is an error from your piechart')}});}
function _generate_paxtrend_chart(url,canvas_id){$.ajax({url:url,dataType:"json",success:function(result){var body1="";var body2="";var body3="";var pax_value=result["pax_trend"]['paxtotal'];var d2_test=result["table_result"]['Total'][1];var d7_test=result["table_result"]['Total'][3];var d7_pax=result["top_ratio"]["top_ratio"][0];var d2_posit=result["table_result"]['Total'][2];var d7_posit=result["table_result"]['Total'][4];body1=`<div id="pax_first"><p><h2><b><i>${pax_value}</i></b></h2><h3><b><i>passengers</i></b></h3></p></div>`;$("#pax_first").remove();$("#pax_top_block").append(body1);body2=`<div class="d2_top_top"><p><h4 style="color:black;"><b><i>${result["top_ratio"]["top_ratio"][1]}% Testing Ratio</i></b></h4></p></div>
                        <div class="d2_first"><p><h5><b><i>${d2_test} test done out of ${pax_value}</i></b></h5></p></div>
                        <div class="d2_second"><p><h5><b><i>${d2_posit} positive out of ${d2_test}</i></b></h5></p></div>`;$(".d2_top_top").remove();$(".d2_first").remove();$(".d2_second").remove();$("#d2_top_block").append(body2);body3=`<div class="d7_top_top"><p><h4 style="color:black;"><b><i>${result["top_ratio"]["top_ratio"][2]}% Testing Ratio</i></b></h4></p></div>
                        <div  class="d7_first"><p><h5><b><i>${d7_test} test done out of ${d7_pax}</i></b></h5></p></div>
                        <div class="d7_second"><p><h5><b><i>${d7_posit} positive out of ${d7_test}</i></b></h5></p></div>`;$(".d7_top_top").remove();$(".d7_first").remove();$(".d7_second").remove();$("#d7_top_block").append(body3);var body4='';var tot_pax=result.top_block.paxcount;var tot_d2_test=result.top_block.d2_test;var tot_d7_test=result.top_block.d7_test;var tot_child=result.top_block.child;var tot_diplomats=result.top_block.diplomats;var tot_fullyvax=result.top_block.fullyvax;body4=`<tr class="tpblocks_tbody">
                            <td>${tot_pax}</td>
                            <td>${tot_d2_test}</td>
                            <td>${tot_d7_test}</td>
                            <td>${tot_child}</td>
                            <td>${tot_diplomats}</td>
                            <td>${tot_fullyvax}</td>
                        </tr>`;$("#tpblocks_tbody").remove();$("#tot_topblocks").append(body4);nitpchart_BarWithLine(canvas_id,result["pax_trend"]['weektext'],'Fully Vax',result["pax_trend"]['fullyvax'],'Paxcount',result["pax_trend"]['paxcount'],'Diplomats',result["pax_trend"]['diplomats'],'Fully Vaccinated, Paxcount, Diplomats',);Swal.close();},error:function(error){console.log('there is an error trying to generate paxtrend_chart')}});}
function _generate_d2_d7_hist_chart(url,canvas_id,canvas_id2,canvas_id3,label1A,label2A,label1B,label2B,label1C,label2C){if($("#ncm_d2_histogram").length){$.ajax({url:url,dataType:"json",success:function(result){nitpchart_Histogram(canvas_id,result['DBar_ratio']["weektext"],label1A,result['DBar_ratio']["D2ratio"],label2A,result['DBar_ratio']["D7ratio"],'Percentage',);nitpchart_Histogram(canvas_id2,result['D2_DBar']["weektext"],label1B,result['D2_DBar']["d2test"],label2B,result['D2_DBar']["d2positive"],'Test Count',);nitpchart_Histogram(canvas_id3,result['D7_DBar']["weektext"],label1C,result['D7_DBar']["d7test"],label2C,result['D7_DBar']["d7positive"],'Test Count',);},error:function(error){console.log('there is an error trying to generate histogram')}});}}
$('#switch_states_statecateg_form').click('submit',function(e){var arg_url='';var cleanurls=getUrlParameters();arg_url=cleanurls[1]+'?stateid='+$('#stateid_category').val();_generate_d2_d7_chart(arg_url,"ncm_d2_canvas","D2Positivity","ncm_d7_canvas","D7Positivity");_generate_d2_d7_hist_chart(arg_url,"ncm_d2d7_ratio_histogram","ncm_d2_histogram","ncm_d7_histogram","D2 Testing Ratio","D7 Testing Ratio","D2 Test","D2 Positive","D7 Test","D7 Positive");_generate_paxtrend_chart(arg_url,"ncm_paxtrend_histogram");_generate_daily_tables(arg_url);});}};})(jQuery);